<!DOCTYPE html>
<html lang="sv">
    <head>
        <base href="{% url 'index' %}">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Budgethak</title>
        <link rel="shortcut icon" href="/media/favicon.ico" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.3.0/MarkerCluster.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}budgethak/css/markercluster.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}lib/leaflet-usermarker/leaflet.usermarker.css" />
        <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
        <link rel="stylesheet" href="{{ STATIC_URL }}lib/jquery-ui-1.12.0.custom/jquery-ui.min.css" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.10.0/jquery.timepicker.min.css" integrity="sha256-zV9aQFg2u+n7xs0FTQEhY0zGHSFlwgIu7pivQiwJ38E=" crossorigin="anonymous" />
        <link rel="stylesheet" href="//www.w3schools.com/lib/w3.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}budgethak/css/main.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}budgethak/css/mapview.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}budgethak/css/menubarview.css" />
        <link rel="stylesheet" href="{{ STATIC_URL }}budgethak/css/sidebarview.css" />
    </head>
    <body>
        <script id="autocompleteItem" type="text/template">
            <li>
                <div class="w3-container">
                    <p class="autocomplete-name w3-medium"><%- name %></p>
                    <p class="autocomplete-address w3-small"><%- street_address %>, <%- city %></p>
                </div>
            </li>
        </script>

        <script id="menuBar" type="text/template">
            <div id="menu-bar-container" class="w3-card-4">
                <div class="w3-container menu-bar-element w3-hide-medium w3-hide-large">
                    <div class="menu-bar-element-section link" id="mobile-menu-button">
                        <i class="fa fa-bars menu-bar-icon icon clickable"></i>
                    </div>
                </div>
                <div class="w3-row menu-bar-row">
                    <div class="w3-container w3-card-4 menu-bar-element">
                        <div class="menu-bar-element-section link" id="my-location-icon" title="Gå till min position">
                            <i class="fa fa-location-arrow menu-bar-icon icon clickable"></i>
                        </div>
                    </div>
                    <div class="w3-container w3-card-4 menu-bar-element">
                        <div class="menu-bar-element-section link" id="filter-closed-places-icon" title="Dölj stängda platser">
                            <i class="far fa-clock menu-bar-icon icon clickable"></i>
                        </div>
                    </div>
                    <div class="w3-container w3-card-4 menu-bar-element">
                        <div class="menu-bar-element-section link" id="info-icon" title="Information">
                            <i class="fa fa-info-circle menu-bar-icon icon clickable"></i>
                        </div>
                    </div>
                    <div class="w3-container w3-card-4 menu-bar-element">
                        <div class="menu-bar-element-section link" id="add-place-icon" title="Lägg till plats">
                            <i class="fa fa-plus-circle menu-bar-icon icon clickable"></i>
                        </div>
                    </div>
                </div>
                <div class="w3-row menu-bar-row" id="search-row">
                    <div class="w3-container w3-card-4 menu-bar-element" id="search-element">
                        <div class="menu-bar-element-section link" id="search-icon" title="Sök platser">
                            <i class="fa fa-search menu-bar-icon icon clickable"></i>
                        </div>
                        <div class="menu-bar-element-section w3-right" id="search-field-container">
                            <input type="text" id="search-field" placeholder="Sök ..." />
                        </div>
                    </div>
                </div>
                <div class="w3-row menu-bar-row" id="max-beer-price-row">
                    <div class="w3-container w3-card-4 w3-left menu-bar-element" id="max-beer-price-container">
                        <div class="menu-bar-element-section" id="max-beer-price-element">
                            <i class="far fa-money-bill-alt menu-bar-icon icon w3-left" title="Max ölpris"></i>
                            <div id="max-beer-price-slider" class="w3-left w3-large"></div>
                            <p class="w3-left w3-large"><span id="max-beer-price"><%= max_beer_price %></span> kr</p>
                        </div>
                    </div>
                </div>
            </div>
        </script>

        <script id="placeText" type="text/template">
            <div class="w3-container w3-padding-0">
                <table id="sidebar-header">
                    <tr>
                        <td><h3 class="w3-left"><%- name %></h3></td>
                        <td>
                            <div class="w3-right" id="sidebar-icons">
                                <i class="fas fa-map-marker-alt icon clickable sidebar-icon" id="place-map-marker" title="Visa plats på kartan" />
                                <i class="fas fa-edit icon clickable sidebar-icon" id="edit-place-icon" title="Uppdatera platsinfo" />
                                <i class="fas fa-times icon clickable sidebar-icon" id="close-sidebar-button" title="Stäng" />
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="sidebar-block-1">
                <% if (image != '') { %>
                    <p>
                        <img src="{{ MEDIA_URL }}<%= image %>" class="place-image w3-round w3-card-4" />
                    </p>
                <% } %>
                <div class="w3-container w3-padding-0">
                    <p><%- street_address %>, <%- city %></p>
                    <p>
                        Ölpris: <% print (beer_price ? beer_price+" kr" : "Okänt"); %>
                        <% print (beer_price_until ? " (t.o.m. "+beer_price_until+")" : ""); %>
                    </p>
                    <p>
                        Uteservering: 
                        <% if (true == uteservering) { %>
                            <strong class="w3-text-green">JA</strong>
                        <% } else if (false == uteservering) { %>
                            <strong class="w3-text-red">NEJ</strong>
                        <% } %>
                    </p>
                </div>
            </div>
            <div id="sidebar-block-2">
                <% if (opening_hours.length > 0) { %>
                <h5 class="opening-hours-headline">Öppettider</h5>
                <table class="opening-hours-table">
                <% _.each(opening_hours, function(elem) { %>
                <tr>
                    <td>
                        <%- budgethak.weekdays[elem.start_weekday] %>
                        <% if (elem.end_weekday != elem.start_weekday) { %>
                        - <%- budgethak.weekdays[elem.end_weekday].toLowerCase() %>
                        <% } %>
                    </td>
                    <% if (elem.closed_entire_day) { %>
                    <td colspan="2">Stängt</td>
                    <% } else { %>
                    <td>
                        <% print(elem.opening_time || '00:00'); %>
                    </td>
                    <td>
                        - <% print(elem.closing_time || '00:00'); %>
                    </td>
                    <% } %>
                </tr>
                <% }); %>
                </table>
                <% if (open_now === true) { %>
                    <p class="w3-text-green"><strong>Öppet just nu \o/</strong></p>
                <% } else if (open_now === false) { %>
                    <p class="w3-text-red"><strong>Stängt just nu :-(</strong></p>
                <% } %>
                <% } %> <!-- opening_hours -->
                <% if (comment != '') { %>
                <h5>Övrigt</h5>
                <p><%- comment %></p>
                <% } %>
            </div>
        </script>

        <script id="placeEdit" type="text/template">
            <form action="." method="post">
                {% csrf_token %}
                <input type="hidden" name="slug" value="<%= slug %>" />
                <div class="w3-container w3-padding-0">
                    <h3>
                        <input class="w3-input w3-border" type="text" name="name" value="<%- name %>" />                    
                    </h3>
                </div>
                <div id="sidebar-block-1">
                    <% if (image != '') { %>
                    <p>
                        <img src="{{ MEDIA_URL }}<%= image %>" class="place-image w3-round w3-card-4" />
                    </p>
                    <% } %>
                    <div class="w3-container w3-padding-0">
                        <p>
                            <label for="beer_price">Ölpris</label>
                            <input type="number" min="1" max="40" class="w3-input w3-border" name="beer_price" id="beer_price" value="<%- beer_price %>" />
                            <label for="beer_price_until">Ölpris gäller t.o.m. klockan</label>
                            <input type="text" class="w3-input w3-border timepicker" name="beer_price_until" id="beer_price_until" value="<%- beer_price_until %>" />
                        </p>
                        <p>
                            <input type="checkbox" name="uteservering" class="w3-check" id="uteservering"<% print (true == uteservering ? " checked" : "") %> />
                            <label for="uteservering">Uteservering</label>
                        </p>
                    </div>
                </div>
                <div id="sidebar-block-2">
                    <h5 class="opening-hours-headline">Öppettider</h5>
                    <table class="opening-hours-table">
                        <% 
                            var idx = 0;
                            var elem;
                            for (var day = 0; day < 7; day++) { 
                                elem = null;
                                do {
                                    if (opening_hours[idx] && opening_hours[idx].start_weekday <= day && opening_hours[idx].end_weekday >= day)
                                        elem = opening_hours[idx];
                                    else
                                        idx++;
                                } while (elem == null && idx < 7);
                        %>
                        <tr>
                            <td><%- budgethak.weekdays[day] %></td>
                            <td>
                                <input type="text" class="timepicker" name="opening_time[<%= day %>]" id="opening_time[<%= day %>]" value="<% print (elem != null && elem.opening_time != null ? elem.opening_time : "") %>" />
                                - <input type="text" class="timepicker" name="closing_time[<%= day %>]" id="closing_time[<%= day %>]" value="<% print (elem != null && elem.closing_time != null ? elem.closing_time : "") %>" />
                                <input type="checkbox" name="closed_entire_day[<%= day %>]" id="closed_entire_day[<%= day %>]"<% print (elem != null && elem.closed_entire_day == true ? " checked" : "") %> class="w3-check" />
                                <label for="closed_entire_day[<%= day %>]">Stängt</label>
                            </td>
                        </tr>
                        <% } %>
                    </table>
                    <h5>Kommentar</h5>
                    <textarea name="comment" id="comment" class="w3-input w3-border"></textarea>
                    <button type="submit" class="w3-button submit">Skicka</button>
                    <button class="w3-button cancel">Avbryt</button>
                </div>
            </form>
        </script>

        <script id="infoText" type="text/template">
            <div class="w3-container w3-padding-0">
                <h3 class="w3-left">Vad?</h3>
                <h3 class="w3-right"><i class="fa fa-close icon clickable" id="close-sidebar-button" /></h3>
            </div>
            <p>
                Detta är en tjänst för att enkelt hitta billig öl. Kriteriet är <strong>minst 40 för max 40</strong>, d.v.s.
                man ska, någon gång under dygnet, kunna få minst 40 cl starköl för max 40 kr.
            </p>
            <h3>Vem?</h3>
            <p>
                Jag som byggt detta heter <a href="http://robert.huseli.us/">Robert Huselius</a>.
            </p>
            <h3>Hur?</h3>
            <p>
                Denna sajt använder <a href="https://www.djangoproject.com/">Django</a>, 
                <a href="http://www.django-rest-framework.org/">Django REST framework</a>, 
                <a href="http://backbonejs.org/">Backbone.js</a>, 
                <a href="http://underscorejs.org/">Underscore.js</a>, 
                <a href="http://www.requirejs.org/">Requirejs</a>, 
                <a href="http://www.w3schools.com/w3css/default.asp">W3.CSS</a>, 
                <a href="http://leafletjs.com/">Leaflet</a>, 
                <a href="http://www.openstreetmap.org/">Openstreetmap</a>,
                <a href="http://jquery.com/">Jquery</a> 
                och lite till.
            </p>
            <h3>Varför?</h3>
            <p>
                För att jag älskar billig öl och programmering.
            </p>
            <h3>
                <img style="width:50%;" class="w3-round w3-card-4" src="{{ MEDIA_URL }}Robert.jpg" />
            </h3>
        </script>

        <script>
            budgethak = {};
            budgethak.weekdays = ['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'Lördag', 'Söndag'];
            {% autoescape off %}
            budgethak.bootstrap = {{ places }};
            {% endautoescape %}
        </script>
        <script data-main="{{ STATIC_URL }}budgethak/js/app" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js"></script>
    </body>
</html>
